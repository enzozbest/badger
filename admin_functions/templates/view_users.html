{% extends 'base_content.html' %}
{% block content %}
<div class="container mt-5">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h1 class="display-5 text-white">
            Registered Users
        </h1>
        <a href="{% url 'admin_dash' %}" class="btn btn-outline-success">Go to the Administrator Dashboard</a>
    </div>

    <form method="get" class="bg-dark text-white p-3 rounded mb-4">
        <p class="text-white">Showing {{ count }} out of {{ total }} users</p>
        <div class="d-flex justify-content-start align-items-center mb-4">
            <div class="me-2">
                <select 
                    name="{{ filter.form.user_type.name }}" 
                    id="{{ filter.form.user_type.id_for_label }}" 
                    class="form-select form-select-sm">
                    {% for choice in filter.form.user_type.field.choices %}
                        <option value="{{ choice.0 }}" {% if choice.0 == filter.form.user_type.value %}selected{% endif %}>
                            {{ choice.1 }}
                        </option>
                    {% endfor %}
                </select>
            </div>
            <div class="flex-grow-1">
                <label for="{{ filter.form.search.id_for_label }}" class="form-label d-none">
                    {{ filter.form.search.label }}
                </label>
                <input 
                    type="text" 
                    name="{{ filter.form.search.name }}" 
                    id="{{ filter.form.search.id_for_label }}" 
                    class="form-control form-control-sm" 
                    placeholder="Search users..." 
                    value="{{ request.GET.search }}">
            </div>
            <div class="ms-2">
                <button type="submit" class="btn btn-outline-light btn-sm">Filter</button>
            </div>
        </div>
        
        
    </form>
    <table class="table table-dark table-striped table-hover mt-3">
        <table class="table table-dark table-striped table-hover mt-3">
            <thead>
                <tr>
                    <th scope="col">
                        <a href="?{% for key, value in request.GET.items %}{% if key != 'sort' and key != 'page' %}{{ key }}={{ value }}&{% endif %}{% endfor %}sort=email">
                            Email Address
                            {% if request.GET.sort == "email" %}
                                <i class="fas fa-sort-up"></i>
                            {% elif request.GET.sort == "-email" %}
                                <i class="fas fa-sort-down"></i>
                            {% endif %}
                        </a>
                    </th>
                    <th scope="col">
                        <a href="?{% for key, value in request.GET.items %}{% if key != 'sort' and key != 'page' %}{{ key }}={{ value }}&{% endif %}{% endfor %}sort=first_name">
                            First Name
                            {% if request.GET.sort == "first_name" %}
                                <i class="fas fa-sort-up"></i>
                            {% elif request.GET.sort == "-first_name" %}
                                <i class="fas fa-sort-down"></i>
                            {% endif %}
                        </a>
                    </th>
                    <th scope="col">
                        <a href="?{% for key, value in request.GET.items %}{% if key != 'sort' and key != 'page' %}{{ key }}={{ value }}&{% endif %}{% endfor %}sort=last_name">
                            Last Name
                            {% if request.GET.sort == "last_name" %}
                                <i class="fas fa-sort-up"></i>
                            {% elif request.GET.sort == "-last_name" %}
                                <i class="fas fa-sort-down"></i>
                            {% endif %}
                        </a>
                    </th>
                    <th scope="col">
                        <a href="?{% for key, value in request.GET.items %}{% if key != 'sort' and key != 'page' %}{{ key }}={{ value }}&{% endif %}{% endfor %}sort=user_type">
                            Account Type
                            {% if request.GET.sort == "user_type" %}
                                <i class="fas fa-sort-up"></i>
                            {% elif request.GET.sort == "-user_type" %}
                                <i class="fas fa-sort-down"></i>
                            {% endif %}
                        </a>
                    </th>
                    <th scope="col">Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for user in page_obj %}
                    <tr>
                        <td>{{ user.email|lower }}</td>
                        <td>{{ user.first_name }}</td>
                        <td>{{ user.last_name }}</td>
                        <td>{{ user.user_type }}</td>
                        <td>
                            {% if user.user_type != "Admin" %}
                                <a href="{% url 'make_admin' user.id %}" class="btn btn-primary btn-sm">Make Administrator</a>
                            {% endif %}
                        </td>
                    </tr>
                {% empty %}
                    <tr>
                        <td colspan="5" class="text-center text-muted">No users registered.</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
        
        <tbody>
            {% for user in page_obj %}
                <tr>
                    <td>{{ user.email|lower }}</td>
                    <td>{{ user.first_name }}</td>
                    <td>{{ user.last_name }}</td>
                    <td>{{ user.user_type }}</td>
                    <td>
                        {% if user.user_type != "Admin" %}
                            <a href="{% url 'make_admin' user.id %}" class="btn btn-primary btn-sm">Make Administrator</a>
                        {% endif %}
                    </td>
                </tr>
            {% empty %}
                <tr>
                    <td colspan="5" class="text-center text-muted">No users registered.</td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
    {% include 'partials/_pagination.html' %}
</div>
{% endblock %}